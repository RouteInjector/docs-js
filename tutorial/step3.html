
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Step 3 Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="../configuration/" />
    
    
    <link rel="prev" href="step2.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../installation/">
            
                <a href="../installation/">
            
                    
                    Installation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../installation/prerequisites.html">
            
                <a href="../installation/prerequisites.html">
            
                    
                    Prerequisites
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../installation/generator.html">
            
                <a href="../installation/generator.html">
            
                    
                    Generator
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../installation/folders.html">
            
                <a href="../installation/folders.html">
            
                    
                    Folder structure
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="./">
            
                <a href="./">
            
                    
                    Tutorial
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="step1.html">
            
                <a href="step1.html">
            
                    
                    Step 1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="step2.html">
            
                <a href="step2.html">
            
                    
                    Step 2
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.3" data-path="step3.html">
            
                <a href="step3.html">
            
                    
                    Step 3
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../configuration/">
            
                <a href="../configuration/">
            
                    
                    Configuration
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../configuration/environment.html">
            
                <a href="../configuration/environment.html">
            
                    
                    Environment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../configuration/application.html">
            
                <a href="../configuration/application.html">
            
                    
                    Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../configuration/auth.html">
            
                <a href="../configuration/auth.html">
            
                    
                    Auth
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../configuration/backoffice.html">
            
                <a href="../configuration/backoffice.html">
            
                    
                    Backoffice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../configuration/bootstrap.html">
            
                <a href="../configuration/bootstrap.html">
            
                    
                    Bootstrap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../configuration/globals.html">
            
                <a href="../configuration/globals.html">
            
                    
                    Globals
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../configuration/log.html">
            
                <a href="../configuration/log.html">
            
                    
                    Log
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../configuration/routes.html">
            
                <a href="../configuration/routes.html">
            
                    
                    Routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../configuration/session.html">
            
                <a href="../configuration/session.html">
            
                    
                    Session
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../configuration/swagger.html">
            
                <a href="../configuration/swagger.html">
            
                    
                    Swagger
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../models/">
            
                <a href="../models/">
            
                    
                    Models
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../models/schema.html">
            
                <a href="../models/schema.html">
            
                    
                    Schema
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../models/injector.html">
            
                <a href="../models/injector.html">
            
                    
                    Injector
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../models/functions.html">
            
                <a href="../models/functions.html">
            
                    
                    Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../models/references.html">
            
                <a href="../models/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../models/denormalize.html">
            
                <a href="../models/denormalize.html">
            
                    
                    Denormalization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../models/dependencies.html">
            
                <a href="../models/dependencies.html">
            
                    
                    Dependencies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../routes/">
            
                <a href="../routes/">
            
                    
                    Routes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../routes/default.html">
            
                <a href="../routes/default.html">
            
                    
                    Default routes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../routes/custom.html">
            
                <a href="../routes/custom.html">
            
                    
                    Custom routes
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../backoffice/">
            
                <a href="../backoffice/">
            
                    
                    Backoffice
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../backoffice/folders.md">
            
                <span>
            
                    
                    Folders
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../backoffice/newtypes.html">
            
                <a href="../backoffice/newtypes.html">
            
                    
                    Adding new types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../backoffice/overrideDir.md">
            
                <span>
            
                    
                    Overriding directives
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../backoffice/overrideSer.md">
            
                <span>
            
                    
                    Overriding services
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../plugins/">
            
                <a href="../plugins/">
            
                    
                    Plugins
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../plugins/create.html">
            
                <a href="../plugins/create.html">
            
                    
                    Creating a plugin
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../pages/">
            
                <a href="../pages/">
            
                    
                    Pages
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../pages/backoffice.html">
            
                <a href="../pages/backoffice.html">
            
                    
                    Backoffice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../pages/standalone.html">
            
                <a href="../pages/standalone.html">
            
                    
                    Standalone
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../typebased/">
            
                <a href="../typebased/">
            
                    
                    TypeBased
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../typebased/references.html">
            
                <a href="../typebased/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../typebased/references_with_arrays.html">
            
                <a href="../typebased/references_with_arrays.html">
            
                    
                    Arrays with References
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../typebased/arrays.html">
            
                <a href="../typebased/arrays.html">
            
                    
                    Arrays
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../devel/">
            
                <a href="../devel/">
            
                    
                    Development
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../devel/rest.html">
            
                <a href="../devel/rest.html">
            
                    
                    Adding a new REST primitive
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../howto/">
            
                <a href="../howto/">
            
                    
                    Howto
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Step 3</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="step-3-relationships">Step 3. Relationships</h1>
<p>Let&apos;s analyze the relationships between the Company model and the User model. First, we have added a director field that references
to a user instance. In the MongoDB that field will store the ObjectID of the referenced instance. For example, we add a new company and when 
we edit it again, we see its ObjectID in the URL:</p>
<p><img src="step3-1.png" alt=""></p>
<p>Using this ID we can use the Swagger documentation to get the information for this Company in JSON. Remember that the GET API is the one that
retrieves information for a specific model instance.</p>
<p><img src="step3-2.png" alt=""></p>
<p>This information can also be retrieved by directly calling the URL in the browser.</p>
<p><img src="step3-3.png" alt=""></p>
<p>You can see the id of the Company and also that the director field stores the id of the User model. Its information can be retrieved similarly
browsing the User GET API. </p>
<p>This way of modeling the information allows not to replicate information in different models so when we update the User name only one specific 
instance has to be modeled. On the other hand, typical usage will require that after retrieving a Company, an additional query to User has to 
be done to retrieve its director information.</p>
<h2 id="denormalization">Denormalization</h2>
<p>Denormalization allows us to remove this second query, by replicating some of the User data in the Company model. This modeling technique is 
common in NoSQL databases, like MongoDB.</p>
<h4 id="denormalized-company-schema-modelscompanyschemajs">Denormalized Company schema (./models/company/schema.js)</h4>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> schema = <span class="hljs-keyword">new</span> Schema({
    name: {
        type: <span class="hljs-built_in">String</span>
    },
    director: {
        type: ObjectId,
        ref: <span class="hljs-string">&apos;User&apos;</span>
    },
    ceo: {
        type: Schema.Types.Mixed,
        ref: <span class="hljs-string">&apos;User&apos;</span>,
        denormalize: [<span class="hljs-string">&apos;name&apos;</span>,<span class="hljs-string">&apos;surname&apos;</span>]
    }
}, {
    id: <span class="hljs-literal">false</span>
});
</code></pre>
<p>The ceo field is configured to be a Mixed (i.e an unspecified object) that references the User model. The denormalize attribute specifies the 
User fields that must be replicated here.</p>
<p>After restarting NodeJS, we can update the Company to choose its ceo. At the backoffice level, director and ceo fields will be equally rendered,
but if we get again the information from the GET API, we will see that the information is stored in a different way.</p>
<pre><code class="lang-js">{
  <span class="hljs-string">&quot;_id&quot;</span>: <span class="hljs-string">&quot;551ac2f03670088f246afdbb&quot;</span>,
  <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Macrosoft&quot;</span>,
  <span class="hljs-string">&quot;director&quot;</span>: <span class="hljs-string">&quot;551a9dbb6d4e67161b0cfec6&quot;</span>,
  <span class="hljs-string">&quot;ceo&quot;</span>: {
      <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Alex&quot;</span>,
    <span class="hljs-string">&quot;surname&quot;</span>: <span class="hljs-string">&quot;Albal&#xE0;&quot;</span>
  }
}
</code></pre>
<p>The ceo field is stored inside MongoDB as an embedded Object that has the name and surname fields denormalized from the User schema. This technique
improves the frontend usage, because with only one AJAX request we get all the information we need.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="step2.html" class="navigation navigation-prev " aria-label="Previous page: Step 2">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="../configuration/" class="navigation navigation-next " aria-label="Next page: Configuration">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Step 3","level":"1.3.3","depth":2,"next":{"title":"Configuration","level":"1.4","depth":1,"path":"configuration/README.md","ref":"configuration/README.md","articles":[{"title":"Environment","level":"1.4.1","depth":2,"path":"configuration/environment.md","ref":"configuration/environment.md","articles":[]},{"title":"Application","level":"1.4.2","depth":2,"path":"configuration/application.md","ref":"configuration/application.md","articles":[]},{"title":"Auth","level":"1.4.3","depth":2,"path":"configuration/auth.md","ref":"configuration/auth.md","articles":[]},{"title":"Backoffice","level":"1.4.4","depth":2,"path":"configuration/backoffice.md","ref":"configuration/backoffice.md","articles":[]},{"title":"Bootstrap","level":"1.4.5","depth":2,"path":"configuration/bootstrap.md","ref":"configuration/bootstrap.md","articles":[]},{"title":"Globals","level":"1.4.6","depth":2,"path":"configuration/globals.md","ref":"configuration/globals.md","articles":[]},{"title":"Log","level":"1.4.7","depth":2,"path":"configuration/log.md","ref":"configuration/log.md","articles":[]},{"title":"Routes","level":"1.4.8","depth":2,"path":"configuration/routes.md","ref":"configuration/routes.md","articles":[]},{"title":"Session","level":"1.4.9","depth":2,"path":"configuration/session.md","ref":"configuration/session.md","articles":[]},{"title":"Swagger","level":"1.4.10","depth":2,"path":"configuration/swagger.md","ref":"configuration/swagger.md","articles":[]}]},"previous":{"title":"Step 2","level":"1.3.2","depth":2,"path":"tutorial/step2.md","ref":"tutorial/step2.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"tutorial/step3.md","mtime":"2019-09-27T11:52:06.425Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-09-27T11:52:56.608Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

